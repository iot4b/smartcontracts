pragma ever-solidity ^0.71.0;
pragma AbiHeader expire;

contract Test {
    string public data_;
    string public v_;

    constructor(string data, string v) {
        tvm.accept();
        data_ = data;
        v_ = v;
    }

    function get() public view returns (string data, string v) {
        tvm.accept();
        return (data_, v_);
    }

    function set(string data, string v) public {
        tvm.accept();
        data_ = data;
        v_ = v;
    }

    function upgrade(TvmCell code) public {
        tvm.accept();

        TvmBuilder builder;

        builder.store(data_);
        builder.store(v_);

        tvm.setcode(code);
        tvm.setCurrentCode(code);

        onCodeUpgrade(builder.toCell());
    }

    function onCodeUpgrade(TvmCell cell) private {
        tvm.resetStorage();

        TvmSlice s = cell.toSlice();
        (data_, v_) = s.load(string, string);
    }
}
